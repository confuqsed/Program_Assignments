(self.webpackChunk=self.webpackChunk||[]).push([[274],{47750:(e,i,t)=>{t.r(i),t.d(i,{G2FeatureImpl:()=>Ye});var r=t(49231),a=t(82823),n=t(65647),s=t(50824),l=t(25770),d=t(90023),o=t(67167),h=t(77141);const c=r.lazy((()=>Promise.all([t.e(7898),t.e(2796),t.e(8012),t.e(274)]).then(t.bind(t,1284)).then((({ParagraphHighlightCollection:e})=>({default:e}))))),g=r.lazy((()=>Promise.all([t.e(7898),t.e(2796),t.e(8012),t.e(274)]).then(t.bind(t,64738)).then((({SidelineCollection:e})=>({default:e})))));var p=t(36072),m=t(65882),u=t(55446),w=t(90049),_=t(64965),v=t(78488),f=t(60841),S=t(49766),b=t(73863),y=t(34859),C=t(10595),R=t(20715),x=t(58303),I=t(95907);var E=t(35788);function F(e){return e.trim().split(/\s+/).filter((e=>""!==e)).length}function k(e,i){return e.map((e=>function(e,i){return(0,d.zG)(e.transformJSON.alternatives,x.UI((({alternatives:e,context:i})=>({alternative:e[0],context:i[0]}))),x.UI((({alternative:e,context:i})=>({ops:e.ops,context:i}))),x.UI((({ops:t,context:r})=>{let a=r.s,n=0;for(const e of t)E.s.match((e=>{E.s.isInsertString(e)&&(n+=F(e.insert),a+=e.insert.length)}),(e=>{const t=a+e.delete;n+=F(i.slice(a,t)),a=t}),(e=>{a+=e.retain}))(e);return n*((s=e.patternName).includes("MissingSpace")||s.includes("RedundantSpace")||s.includes("Clarity")||s.includes("Punctuation")?.5:s.includes("Formatting")||s.includes("Passive")||s.includes("Dialects")?.25:s.includes("Calliope")?.75:s.includes("Tone")||s.includes("Engagement")?.1:s.includes("RunOn")?2:s.includes("Style")?.5:s.includes("Fluency")||s.includes("FluencyRewrite")?.25:1);var s})),x.fS((()=>0)))}(e,i))).reduce(((e,i)=>e+i),0)}function T(e,i,t){if(e.text.length<50)return x.YP;const r=function(e,i){return e.filter((e=>e.transformJSON.highlights.some((e=>e.s>=i.start&&e.e<=i.end))))}(i,e.textRange);if(r.some((e=>e.patternName.startsWith("WritingExpert"))))return x.G("writingCoach");const a=k(r.filter((e=>!e.patternName.startsWith("WritingExpert"))),t),n=(s=e.text,Math.max(5,Math.min(10,F(s)/10)));var s;return Math.round(a)>=n?x.G("attention"):x.YP}var G=t(40568),M=t(18117);class L{constructor(e){this._params=e,this._subs=new a.w,this._logger=h.Y.create("SidelineCollectionViewModelImpl"),this._paragraphSidelines=l.h.create([]),this._paragraphSidelineById=new Map,this._emphasizedSideline=l.h.create(x.YP),this._activeSideline=l.h.create(x.YP),this._pinnedSideline=l.h.create(x.YP),this._selectionSideline=l.h.create(x.YP),this._shouldHideSidelinesDueToScrolling=l.h.create(!1),this._shouldHideSidelines=l.h.create(!1),this._referenceElementBySidelineId=new Map,this._sidelineCardActiveNotifications=new p.xQ,this._deactivateSidelineSubs=new a.w,this._unpinSidelineSubs=new a.w,this.paragraphSidelines=this._paragraphSidelines.view(),this.emphasizedSideline=this._emphasizedSideline.view(),this.activeSideline=this._activeSideline.view(),this.pinnedSideline=this._pinnedSideline.view(),this.selectionSideline=this._selectionSideline.view(),this.shouldHideSidelines=this._shouldHideSidelines.view(),this._subs.add(m.aj([this._params.paragraphHighlightCollectionViewModel.paragraphHighlights,this._params.alerts]).pipe(n.U((([e,i])=>e.map((e=>{if(!e.isScrolledIntoView)return null;const t=(0,d.zG)(this._params.paragraphCollectionService.getParagraphById(e.paragraphId),x.g_((()=>null),(t=>function(e,i,t,r){const a=`g2-paragraph-sideline-${e.textRange.start}-${e.textRange.end}`,n=T(e,t,r);return{kind:"paragraphSideline",id:a,paragraphId:e.id,paragraphHighlightViewportRect:{top:i.viewportRect.top,left:i.viewportRect.left,width:i.viewportRect.width,height:i.viewportRect.height},signal:n}}(t,e,i,this._params.textObserver.getCurrentTextMap().getPlainText()))));return null===t?(this._params.telemetry.warn({message:"Creating sideline failed."}),this._logger.warn("Failed to create paragraph sideline; skipping.",{paragraphId:e.paragraphId}),null):t})).filter(I.Nf)))).subscribe(s.wW(this._paragraphSidelines))),this._subs.add(m.aj([this._paragraphSidelines,this._params.paragraphHighlightCollectionViewModel.emphasizedParagraphHighlight]).pipe(n.U((([e,i])=>(0,d.zG)(i,x.tS((i=>x.ij(e.find((e=>e.paragraphId===i.paragraphId))))))))).subscribe(s.wW(this._emphasizedSideline))),this._subs.add(this._paragraphSidelines.subscribe((e=>{this._paragraphSidelineById.clear();for(const i of e)this._paragraphSidelineById.set(i.id,i)}))),this._subs.add(m.aj([this._params.selectionHighlightViewModel.selectionHighlight,this._activeSideline]).pipe(u.h((([e,i])=>(0,d.zG)(M.Yt(x.Kw)({selectionSideline:this._selectionSideline.get(),activeSideline:i}),x.g_(d.W8,(({selectionSideline:e,activeSideline:i})=>e.id!==i.id))))),n.U((([e])=>(0,d.zG)(e,x.hX((e=>e.isScrolledIntoView)),x.UI((e=>({kind:"selectionSideline",id:`g2-selection-sideline-${e.textRange.start}-${e.textRange.end}`,text:e.text,textRange:e.textRange,selectionHighlightViewportRect:{top:e.viewportRect.top,left:e.viewportRect.left,width:e.viewportRect.width,height:e.viewportRect.height}}))))))).subscribe(s.wW(this._selectionSideline))),this._subs.add(w.T(this._params.textFieldLayout.scroll.changes,_.R((0,G.Jj)(this._params.textFieldElement),"scroll",{capture:!0})).pipe(v.b((()=>this._shouldHideSidelinesDueToScrolling.set(!0))),f.w((()=>S.timer(1e3).pipe(v.b((()=>this._shouldHideSidelinesDueToScrolling.set(!1))))))).subscribe()),this._subs.add(m.aj([this._params.legacyAssistantOpenState,this._params.assistantState,this._shouldHideSidelinesDueToScrolling]).pipe(n.U((([e,i,t])=>"open"===e||"opened"===i.kind||t))).subscribe(s.wW(this._shouldHideSidelines))),this._subs.add(this._emphasizedSideline.subscribe((e=>this._logger.debug("Emphasized sideline updated.",e)))),this._subs.add(this._activeSideline.subscribe((e=>this._logger.debug("Active sideline updated.",e)))),this._subs.add(this._pinnedSideline.subscribe((e=>this._logger.debug("Pinned sideline updated.",e)))),this._subs.add(this._selectionSideline.subscribe((e=>this._logger.debug("Selection sideline updated.",e))))}_doesSidelineIdMatchRelevantSideline(e,i){return(0,d.zG)(i,x.g_((()=>!1),(i=>e===i.id)))}_getSidelineById(e){return(0,d.zG)(x.ij(this._paragraphSidelineById.get(e)),x.Gk((()=>(0,d.zG)(this._selectionSideline.get(),x.hX((i=>i.id===e))))))}_deactivateSideline(e,i=!1){this._logger.debug("Deactivating sideline.",{sidelineId:e}),this._doesSidelineIdMatchRelevantSideline(e,this._activeSideline.get())?this._deactivateSidelineSubs=this._sidelineCardActiveNotifications.pipe(u.h((i=>i===e)),b.q(1),y.h(!1),C.L(i?0:1e3,R.of(!0))).subscribe((i=>{i?(this._logger.debug("Did not receive notification that corresponding sideline card is active, proceeding to deactivate sideline.",{sidelineId:e}),this._activeSideline.set(x.YP)):this._logger.debug("Received a notification that corresponding sideline card is active, won't deactivate sideline.",{sidelineId:e})})):(this._params.telemetry.warn({message:"Deactivation of an inactive sideline attempted."}),this._logger.warn("Tried to deactivate sideline that is not active, this is a no-op.",{sidelineId:e}))}_unpinSideline(e,i=!1){this._logger.debug("Unpinning sideline.",{sidelineId:e}),this._doesSidelineIdMatchRelevantSideline(e,this._pinnedSideline.get())?this._unpinSidelineSubs=this._sidelineCardActiveNotifications.pipe(u.h((i=>i===e)),b.q(1),y.h(!1),C.L(i?0:1e3,R.of(!0))).subscribe((i=>{i?(this._logger.debug("Did not receive notification that corresponding sideline card is active, proceeding to unpin sideline.",{sidelineId:e}),this._pinnedSideline.set(x.YP),this._deactivateSideline(e,!0)):this._logger.debug("Received a notification that corresponding sideline card is active, won't unpin sideline.",{sidelineId:e})})):(this._params.telemetry.warn({message:"Unpinning of an unpinned sideline attempted."}),this._logger.warn("Tried to unpin sideline that is not pinned, this is a no-op.",{sidelineId:e}))}activateSideline(e){this._logger.debug("Activating sideline.",{sidelineId:e});const i=this._getSidelineById(e);x.pC(i)?(this._deactivateSidelineSubs.unsubscribe(),this._activeSideline.set(i),this._emphasizedSideline.set(i)):(this._params.telemetry.warn({message:"Activation of a non-existent sideline attempted."}),this._logger.warn("Tried to activate non-existing sideline, this is a no-op.",{sidelineId:e}))}deactivateSideline(e){this._deactivateSideline(e)}pinSideline(e){this._logger.debug("Pinning sideline.",{sidelineId:e});const i=this._getSidelineById(e);x.pC(i)?(this._pinnedSideline.set(i),this.activateSideline(e)):(this._params.telemetry.warn({message:"Pinning of a non-existent sideline attempted."}),this._logger.warn("Tried to pin non-existing sideline, this is a no-op.",{sidelineId:e}))}unpinSideline(e){this._unpinSideline(e)}setSidelineReferenceElement(e,i){this._referenceElementBySidelineId.set(e,i)}getSidelineReferenceElement(e){return x.ij(this._referenceElementBySidelineId.get(e))}notifySidelineCardActive(e){this._sidelineCardActiveNotifications.next(e)}notifySidelineCardInactive(e,i){this._unpinSideline(e,i),this._deactivateSideline(e,i)}getSidelineById(e){return this._getSidelineById(e)}getSidelineTextInfo(e){return(0,d.zG)(this._getSidelineById(e),x.tS((e=>"selectionSideline"===e.kind?x.G({text:e.text,textRange:e.textRange}):(0,d.zG)(this._params.paragraphCollectionService.getParagraphById(e.paragraphId),x.UI((e=>({text:e.text,textRange:e.textRange})))))))}dispose(){this._subs.unsubscribe(),this._deactivateSidelineSubs.unsubscribe(),this._unpinSidelineSubs.unsubscribe()}}var P=t(57724),z=t(98030),A=t(14765),H=t(84548),V=t(27296),B=t(65585),N=t(12201),U=t(36255),D=t(29101);function O(e,i){return e.pipe(A.O(null),n.U((()=>(0,d.zG)(i.getCurrentSelection(!0),D.Ls,x.ij,x.hX((0,d.ff)(U.SV.isCollapsed))))),S.skipBy(x.Eh(U.SV.eq)))}class Y{constructor(e){this._params=e,this._subs=new a.w,this._logger=h.Y.create("G2IntegrationGoogleDocs"),this._textFieldVisibleRect=l.h.create({top:0,left:0,width:0,height:0}),this._highlightCollectionFilterSource=new N.b(this._params.textObserver),this._selectionRange=l.h.create(x.YP),this.name="g2-google-docs-integration",this.textFieldVisibleRect=this._textFieldVisibleRect.view(),this.highlightGeometryFilter=this._highlightCollectionFilterSource.highlightsFilterFactory(),this.selectionRange=this._selectionRange.view(),this._subs.add(m.aj([this._params.textFieldLayout.rect.changes.pipe(A.O(this._params.textFieldLayout.rect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(A.O(this._params.textFieldLayout.scroll.getCurrent()))]).pipe(n.U((()=>{var e;const i=this._params.textFieldElement.getBoundingClientRect(),t={top:i.top,left:i.left,width:i.width,height:i.height},r=(0,B.Gg)(this._params.textFieldElement)||(0,B.g)(this._params.textFieldElement)||(0,G.Jj)(this._params.textFieldElement).document.documentElement,a=this._params.textFieldElement.querySelector(H.gv);if(null!==a){const{left:i,width:n}=null!==(e=V.UL.getIntersection(t,a.getBoundingClientRect()))&&void 0!==e?e:t,s=V.UL.getIntersection({...t,left:i,width:n},r.getBoundingClientRect());return null!==s?s:(this._logger.warn("Failed to find intersection between the text field and its first scrollable ancestor. The resulting text field's visible rect may not be appropriate."),{...t,left:i,width:n})}{this._logger.warn("Failed to retrieve rendering canvas. The resulting text field's visible rect lateral boundaries may not be appropriate.");const e=V.UL.getIntersection(t,r.getBoundingClientRect());return null!==e?e:(this._logger.warn("Failed to find intersection between the text field and its first scrollable ancestor. The resulting text field's visible rect may not be appropriate."),t)}}))).subscribe(s.wW(this._textFieldVisibleRect))),this._subs.add(O(this._params.selectionSource.data.behavior.pipe(y.h(void 0)),this._params.selectionService).subscribe(s.wW(this._selectionRange)))}dispose(){this._subs.unsubscribe()}}var W=t(74857),j=t(58322);const $={[j.u.gmailCompose]:15,[j.u.gmailReply]:16,[j.u.gmailComposeStandalone]:15,[j.u.gmailComposeFullScreen]:15,[j.u.slackMessage]:2,[j.u.slackGenericQuill]:2,[j.u.slackThread]:2,[j.u.gDocsCanvas]:0,[j.u.gDocsComments]:0};const J={[j.u.gmailReply]:{top:170,bottom:140}};class q{constructor(e){var i;this._params=e,this._subs=new a.w,this._logger=h.Y.create("G2IntegrationGeneric"),this._textFieldVisibleRect=l.h.create({top:0,left:0,width:0,height:0}),this._selectionRange=l.h.create(x.YP),this.name="g2-generic-integration",this.textFieldVisibleRect=this._textFieldVisibleRect.view(),this.highlightGeometryFilter=P.qH.everything,this.selectionRange=this._selectionRange.view(),this._viewPortOffsets=void 0!==this._params.getVerticalViewportOffsets?this._params.getVerticalViewportOffsets(this._params.integrationName):(i=this._params.integrationName,x.ij(J[i])),this._subs.add(m.aj([this._params.textFieldLayout.visibleRect.changes.pipe(A.O(this._params.textFieldLayout.visibleRect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(A.O(this._params.textFieldLayout.scroll.getCurrent()))]).pipe(n.U((([e])=>{const i={top:e.client.top,left:e.client.left,width:e.size.width,height:e.size.height},t=this._getLeftOffset(),{top:r,bottom:a}=(0,d.zG)(this._viewPortOffsets,x.fS((()=>({top:0,bottom:0}))));return this._getVisibleTextFieldRect(i,r,a,t)}))).subscribe((e=>{this._textFieldVisibleRect.set(e)}))),this._subs.add(O(_.R(this._params.textFieldElement.ownerDocument,"selectionchange").pipe(W.b(100),y.h(void 0)),this._params.selectionService).subscribe(s.wW(this._selectionRange)))}_getVisibleTextFieldRect(e,i,t,r){if(this._params.integrationName===j.u.gmailReply){const a=(0,G.Jj)(this._params.textFieldElement).document.documentElement.getBoundingClientRect(),n=V.UL.getIntersection(e,a);if(n||(this._params.telemetry.warn({message:"Failed to find intersection between the text field's visible layout rect and window rect. The resulting text field's visible rect may not be appropriate."}),this._logger.warn("Failed to find intersection between the text field's visible layout rect and window rect. The resulting text field's visible rect may not be appropriate.",{integrationName:this._params.integrationName})),null===n)return{top:0,height:0,left:0,width:0};const s=n.top<i?i:n.top;return{top:s,height:n.height+n.top>a.height-t?a.height-t-s:n.height,left:n.left-r,width:n.width+r}}return{top:e.top+i,height:e.height-t,left:e.left-r,width:e.width+r}}_getLeftOffset(){return this._params.integrationName in $?function(e){return $[e]}(this._params.integrationName):(this._logger.debug(`No left offset defined for integration with name "${this._params.integrationName}," defaulting to zero.`),0)}dispose(){this._subs.unsubscribe()}}var Q=t(39144),K=t(57945),X=t(43801);const Z=e=>o.S.isTransformJsonCapiAlert(e)&&e.outcome===K.TC.correctness&&e.transformJSON.highlights.every((e=>"enclosing"!==e.type)),ee=d.W8;var ie=t(47579),te=t(66571),re=t(12518),ae=t(92054),ne=t(65078),se=t(61031),le=t(36661),de=t(6824),oe=t(11623),he=t(50324);const ce=le.S((e=>e.struct({kind:e.literal(oe.PU.Final)}))),ge=le.S((e=>e.intersect(ce(e))(he.WV(e)))),pe=le.n(de.Schemable)(ge).is,me=le.n(de.Schemable)(he.a9).is;function ue(e){const i=(e=>{switch(e){case"improve":return{kind:"default"};case"rephrase":return{kind:"rephrase"};case"shorten":return{kind:"other",actionId:{id:"VBarG2Shorter"}};case"friendly":return{kind:"other",actionId:{id:"VBarG2Friendly"}};case"formal":return{kind:"other",actionId:{id:"VBarG2Formal"}};case"calliope":return{kind:"other",actionId:{id:"VBarG2Calliope"}};default:(0,te.L0)(e)}})(e.type);return{correlationId:e.id,kind:{...i},entrypoint:{family:"g2",name:oe.K0.VbarCard},args:{},metadata:{}}}var we=t(83138);class _e{constructor(e){this._params=e,this._subs=new a.w,this._logger=h.Y.create("RewriteServiceImpl"),this._relevantCapiMessages=this._params.checkingService.pipe(ne.oA,f.w((e=>e.capiMessages)),u.h((0,ie.Kg)(pe,me))),this._cachedRewriteIdMap=new Map,this._cachedRewriteMap=new Map,this._subs.add(this._relevantCapiMessages.subscribe((e=>this._handleServerMessage(e))))}_handleServerMessage(e){me(e)?(this._params.telemetry.warn({message:'Server message with result "failure" received.'}),this._handleErrorMessage(e)):pe(e)?(this._params.telemetry.infoOncePerMessage({message:'Server message with result "success" received.'}),this._handleRewriteResultMessage(e)):(0,te.vE)(e)}_handleRewriteResultMessage(e){const i=this._cachedRewriteMap.get(e.correlationId);if(void 0===i)this._params.telemetry.warn({message:'Server message with result "success" and unknown correlation ID received.'}),this._logger.warn("Received a successful result with unknown correlation ID.",{resultSuccessMessage:e});else{const t={kind:"ready",id:i.get().id,type:i.get().type,text:i.get().text,textRange:i.get().textRange,title:e.explanation,rewriteText:e.rewrite,rewriteDiff:(0,d.zG)(we.F.getDiff(i.get().text,e.rewrite),re.mapLeft((i=>this._logger.error("Failed to get diff for rewrite.",{error:i,newText:e.rewrite}))),x.Uo)};this._logger.debug("Received a successful result; updating rewrite.",{rewriteBefore:i.get(),rewriteAfter:t}),i.set(t)}}_handleErrorMessage(e){const i=this._cachedRewriteMap.get(e.correlationId);if(void 0===i)this._params.telemetry.warn({message:'Server message with result "failure" and unknown correlation ID received.'}),this._logger.warn("Received a failed result with unknown correlation ID.",{errorMessage:e});else{const t={kind:"error",id:i.get().id,type:i.get().type,text:i.get().text,textRange:i.get().textRange,errorReason:e.errorType.kind,errorDetails:e.details};this._logger.debug("Received a failed result; updating rewrite.",{rewriteBefore:i.get(),rewriteAfter:t}),i.set(t)}}async getRewrite(e,i,t,r=!0){const a=(0,se.Wu)(i),n=`${e}-${t.start}-${t.end}-${a}`,s=this._cachedRewriteIdMap.get(n),d=void 0!==s?this._cachedRewriteMap.get(s):void 0,o=r&&void 0!==d&&"error"!==d.get().kind;if(o)return d;o||void 0===s||this._cachedRewriteMap.delete(s);const h=(0,ae.Z)();this._cachedRewriteIdMap.set(n,h);const c=l.h.create({kind:"loading",id:h,type:e,text:i,textRange:t});this._cachedRewriteMap.set(c.get().id,c);const g=this._params.checkingService.get();if(x.Wi(g))return this._params.telemetry.error({message:"Getting rewrite failed: Checking service not initialized."}),this._logger.error("Failed to get rewrite. Checking service not initialized yet."),c.modify((e=>({...e,kind:"error",errorReason:"Failed to communicate with server."}))),c;const p=ue(c.get());try{const e=await g.value.sendMessage("text_actions:invokeRewrite",p,!1,{kind:"scope",scope:{kind:"sessionText",rev:Number.MIN_SAFE_INTEGER,range:{start:c.get().textRange.start,end:c.get().textRange.end}}})();if(re.isLeft(e))throw e.left.message;return c}catch(e){return this._params.telemetry.error({message:'Getting rewrite failed: Sending "disposable_cheetah:invokeCommand" message to CAPI failed.',error:e}),this._logger.error("Failed to get rewrite. Error sending text_actions:invokeRewrite message to CAPI.",{error:e}),c.modify((e=>({...e,kind:"error",errorReason:"Failed to communicate with server."}))),c}}dispose(){this._subs.unsubscribe()}}const ve=r.lazy((()=>Promise.all([t.e(7898),t.e(2796),t.e(8012),t.e(274)]).then(t.bind(t,16406)).then((({SidelineCard:e})=>({default:e})))));var fe=t(60165);function Se(e){return"improve"===e}var be=t(25989);var ye=t(27794),Ce=t(61442),Re=t(9115);class xe{constructor(e){var i;this._params=e,this._subs=new a.w,this._logger=h.Y.create("SidelineCardViewModelImpl"),this._visibleSidelineCard=l.h.create(x.YP),this._visibleSidelineCardSelectedRewriteType=l.h.create("improve"),this._visibleSidelineCardImproveRewriteInfo=l.h.create(x.G({kind:"idle",type:"improve"})),this._visibleSidelineCardRephraseRewriteInfo=l.h.create(x.G({kind:"idle",type:"rephrase"})),this._visibleSidelineCardCalliopeRewriteInfo=l.h.create(x.YP),this._visibleSidelineCardShortenRewriteInfo=l.h.create(x.YP),this._visibleSidelineCardFriendlyRewriteInfo=l.h.create(x.YP),this._visibleSidelineCardFormalRewriteInfo=l.h.create(x.YP),this.visibleSidelineCard=this._visibleSidelineCard.view(),this.visibleSidelineCardRewriteInfo=l.h.combine(this._visibleSidelineCardImproveRewriteInfo,this._visibleSidelineCardRephraseRewriteInfo,this._visibleSidelineCardCalliopeRewriteInfo,this._visibleSidelineCardShortenRewriteInfo,this._visibleSidelineCardFriendlyRewriteInfo,this._visibleSidelineCardFormalRewriteInfo,((e,i,t,r,a,n)=>({improve:e,rephrase:i,calliope:t,shorten:r,friendly:a,formal:n}))),this._subs.add((i=this._params.sidelineCollectionViewModel,m.aj([i.activeSideline,i.pinnedSideline]).pipe(n.U((([e,i])=>(0,d.zG)(i,x.UI((e=>({sideline:e,isPinned:!0}))),x.wp((()=>(0,d.zG)(e,x.UI((e=>({sideline:e,isPinned:!1}))))))))),n.U(x.tS((({sideline:e,isPinned:t})=>(0,d.zG)(i.getSidelineReferenceElement(e.id),x.UI((i=>({sidelineId:e.id,isSidelinePinned:t,sidelineSignal:"paragraphSideline"===e.kind?e.signal:x.G("selection"),referenceElement:i}))))))))).subscribe((e=>{this._resetVisibleSidelineCard(),(0,ye.gw)(0).then((()=>this._visibleSidelineCard.set(e)))}))),this._subs.add(this._visibleSidelineCard.pipe(ne.oA,f.w((e=>this._visibleSidelineCardSelectedRewriteType.pipe(n.U((i=>({visibleSidelineCard:e,visibleSidelineCardRewriteType:i})))))),f.w((({visibleSidelineCard:e,visibleSidelineCardRewriteType:i})=>function(e,i,t,r){return(0,d.zG)(e.getSidelineTextInfo(t.sidelineId),x.UI((({text:e,textRange:t})=>be.D(i.getRewrite(r,e,t)).pipe(b.q(1),f.w(d.yR),n.U(x.G)))),x.pF((()=>R.of(x.YP))))}(this._params.sidelineCollectionViewModel,this._params.rewriteService,e,i).pipe(n.U((e=>({rewriteType:i,rewrite:e}))))))).subscribe((({rewriteType:e,rewrite:i})=>{switch(e){case"improve":this._visibleSidelineCardImproveRewriteInfo.set(i);break;case"calliope":this._visibleSidelineCardCalliopeRewriteInfo.set(i);break;case"rephrase":this._visibleSidelineCardRephraseRewriteInfo.set(i);break;case"shorten":this._visibleSidelineCardShortenRewriteInfo.set(i);break;case"friendly":this._visibleSidelineCardFriendlyRewriteInfo.set(i);break;case"formal":this._visibleSidelineCardFormalRewriteInfo.set(i);break;default:(0,te.L0)(e)}})));const t=this._visibleSidelineCardSelectedRewriteType.pipe(fe.x(),u.h((0,Re.ff)(Se)));this._subs.add(t.subscribe((()=>{this._visibleSidelineCardCalliopeRewriteInfo.set(x.G({kind:"idle",type:"calliope"})),this._visibleSidelineCardShortenRewriteInfo.set(x.G({kind:"idle",type:"shorten"})),this._visibleSidelineCardFriendlyRewriteInfo.set(x.G({kind:"idle",type:"friendly"})),this._visibleSidelineCardFormalRewriteInfo.set(x.G({kind:"idle",type:"formal"}))})))}_resetVisibleSidelineCard(){this._visibleSidelineCard.set(x.YP),this._visibleSidelineCardRephraseRewriteInfo.set(x.G({type:"improve",kind:"idle"})),this._visibleSidelineCardRephraseRewriteInfo.set(x.G({type:"rephrase",kind:"idle"})),this._visibleSidelineCardCalliopeRewriteInfo.set(x.YP),this._visibleSidelineCardShortenRewriteInfo.set(x.YP),this._visibleSidelineCardFriendlyRewriteInfo.set(x.YP),this._visibleSidelineCardFormalRewriteInfo.set(x.YP),this._visibleSidelineCardSelectedRewriteType.set("improve")}activateSidelineCard(e){this._logger.debug("Activate sideline card.",{sidelineCard:e}),this._params.sidelineCollectionViewModel.notifySidelineCardActive(e.sidelineId)}deactivateSidelineCard(e){this._logger.debug("Deactivate sideline card.",{sidelineCard:e}),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(e.sidelineId)}notifySelectedRewriteTypeChanged(e){this._logger.debug("Selected rewrite type changed.",{rewriteType:e}),this._visibleSidelineCardSelectedRewriteType.set(e)}applyRewrite(e,i){this._logger.debug("Apply rewrite.",{rewrite:e}),this._params.performReplacement({pos:e.textRange,value:e.rewriteText,oldValue:e.text}).then((()=>{this._params.telemetry.info({message:"Applying rewrite succeeded."})})).catch((e=>{this._params.telemetry.error({message:"Applying rewrite failed.",error:e})})),this._params.sidelineCollectionViewModel.notifySidelineCardInactive(i.sidelineId,!0)}async copyRewrite(e){try{await(0,Ce.vQ)(e.rewriteText),this._params.telemetry.info({message:"Copying rewrite succeeded."})}catch(e){this._params.telemetry.error({message:"Copying rewrite failed.",error:e}),this._logger.error("Failed to copy rewrite.",e)}}dispose(){this._subs.unsubscribe()}}var Ie=t(46210);function Ee(e){let i=0,t=0;const r=[];for(;t<=e.length;)"\n"!==e.charAt(t)&&""!==e.charAt(t)||(i!==t&&r.push({start:i,end:t}),i=t+1),t++;return r}class Fe{constructor(e){this._params=e,this._subs=new a.w,this._logger=h.Y.create("ParagraphCollectionServiceImpl"),this._paragraphs=l.h.create([]),this._paragraphById=new Map,this.paragraphs=this._paragraphs.view(),this._subs.add(this._params.textObserver.contentChanges.async.pipe(u.h((e=>!e.deltaChange.isEmpty)),W.b(1e3),A.O(null),n.U((()=>{const e=this._params.textObserver.getCurrentTextMap().getPlainText();return{paragraphTextRanges:Ee(e),fullText:e}})),n.U((({paragraphTextRanges:e,fullText:i})=>{const t=e.map((e=>({id:`g2-paragraph-${e.start}-${e.end}`,textRange:e,text:i.slice(e.start,e.end)})));return this._logger.debug("Paragraphs updated.",{paragraphs:t}),t}))).subscribe(s.wW(this._paragraphs))),this._subs.add(this._paragraphs.subscribe((e=>{this._paragraphById.clear();for(const i of e)this._paragraphById.set(i.id,i)})))}getParagraphById(e){return x.ij(this._paragraphById.get(e))}dispose(){this._subs.unsubscribe()}}var ke=t(41092),Te=t(76553),Ge=t(50725),Me=t(16237),Le=t(61764);var Pe=t(34761),ze=t(59833);const Ae=({viewportRect:{top:e}})=>e,He=({viewportRect:{top:e,height:i}})=>e+i,Ve=e=>{if(e.length<2)return e;const i=e.sort(((e,i)=>Ae(e)-Ae(i))),t=[];let r=0,a=1,n=0;for(;r<e.length;){const e=i[r],s=i[a];void 0===s||Ae(s)>=He(e)?(0===n&&t.push(e),r=a,n=0):(He(s)<=He(e)||(r=a),n++),a++}return t};class Be{constructor(e){this._params=e,this._subs=new a.w,this._logger=h.Y.create("ParagraphHighlightCollectionViewModelImpl"),this._paragraphHighlights=l.h.create([]),this._emphasizedParagraphHighlight=l.h.create(x.YP),this.paragraphHighlights=this._paragraphHighlights.view(),this.emphasizedParagraphHighlight=this._emphasizedParagraphHighlight.view(),this._subs.add(this._params.paragraphCollectionService.paragraphs.subscribe((e=>{const i=Array.from(this._params.paragraphHighlightCollectionGeometry.geometry.get().keys());this._params.paragraphHighlightCollectionGeometry.removeHighlights(i);for(const i of e){const e=P.y$.Id.create(`g2-paragraph-highlight-${i.textRange.start}-${i.textRange.end}`);this._params.paragraphHighlightCollectionGeometry.addHighlight(e,i.textRange,{highlightId:e,alertId:i.id,highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null})}}))),this._subs.add(m.aj([this._params.integration.textFieldVisibleRect,this._params.textFieldLayout.rect.changes.pipe(A.O(this._params.textFieldLayout.rect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(A.O(this._params.textFieldLayout.scroll.getCurrent())),this._params.paragraphHighlightCollectionGeometry.geometry.view((e=>Array.from(e.values())))]).pipe(n.U((([e,i,t,r])=>{const a=r.reduce(((r,a)=>((0,d.zG)(function(e,i,t,r,a,n){return(0,d.zG)(x.ij((0,Me.jr)(t)),x.UI((t=>{const s=(0,Le.Z)({kind:"offsetPoint",...t},r,a),l=s.left-n.left,d=n.left+n.width-s.right,o={top:s.top,left:s.left-l,width:s.width+l+d,height:s.height};return{id:e,paragraphId:i,textFieldRect:{top:t.top,left:t.left-l,width:t.width+l+d,height:t.height},viewportRect:o,isScrolledIntoView:V.UL.doesRectContain(n,o)}})))}(a.meta.highlightId.toString(),a.meta.alertId,a.rects,i.client,t,e),x.g_((()=>{this._params.telemetry.warn({message:"Creating highlight for paragraph failed."}),this._logger.warn("Failed to create paragraph highlight from highlight geometry. Skipping.",a)}),(e=>r.push(e)))),r)),[]);return this._logger.debug("Paragraph highlights updated.",{paragraphHighlights:a}),a})),n.U(Ve)).subscribe(s.wW(this._paragraphHighlights))),this._subs.add(this._params.mouseData.pipe(ke.U(Ge.S.hz30),S.skipBy(Te.Z.eq),n.U((({client:e,offset:i})=>{return t=this._paragraphHighlights.get(),r=e,a=i,n=this._params.textFieldElement,null!==r&&null!==a&&(0,Pe._N)(r,n)?(0,d.zG)(t,ze.Ew((e=>V.UL.contains(a,e.textFieldRect)))):x.YP;var t,r,a,n}))).subscribe(s.wW(this._emphasizedParagraphHighlight)))}dispose(){this._subs.unsubscribe()}}var Ne=t(12920),Ue=t(33229),De=t(53466);class Oe{constructor(e){this._params=e,this._subs=new a.w,this._logger=h.Y.create("SelectionHighlightViewModelImpl"),this._selectionHighlight=l.h.create(x.YP),this.selectionHighlight=this._selectionHighlight.view(),this._subs.add(this._params.integration.selectionRange.subscribe((e=>{this._logger.debug("Selection range changed, updating selection highlight geometry accordingly.",{selectionRange:e});const i=Array.from(this._params.selectionHighlightGeometry.geometry.get().keys());this._params.selectionHighlightGeometry.removeHighlights(i),(0,d.zG)(e,De.bw((e=>{const i=P.y$.Id.create(`g2-selection-highlight-${e.start}-${e.end}`);this._params.selectionHighlightGeometry.addHighlight(i,e,{highlightId:i,text:this._params.textObserver.getCurrentTextMap().getPlainText().slice(e.start,e.end),textRange:e,alertId:"",highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null})})))}))),this._subs.add(m.aj([this._params.integration.textFieldVisibleRect,this._params.textFieldLayout.rect.changes.pipe(A.O(this._params.textFieldLayout.rect.getCurrent())),this._params.textFieldLayout.scroll.changes.pipe(A.O(this._params.textFieldLayout.scroll.getCurrent())),this._params.selectionHighlightGeometry.geometry.view((e=>Array.from(e.values())))]).pipe(n.U((([e,i,t,r])=>(0,d.zG)(x.ij(r[0]),x.tS((r=>function(e,i,t,r){return(0,d.zG)(e,x.DT((e=>F(e.meta.text)>1)),x.tS((e=>(0,d.zG)((0,Me.jr)(e.rects),x.ij,x.UI((a=>{const n=(0,Le.Z)({kind:"offsetPoint",...a},i,t),s=n.left-r.left,l=r.left+r.width-n.right,d={top:n.top,left:n.left-s,width:n.width+s+l,height:n.height};return{id:e.meta.highlightId.toString(),text:e.meta.text,textRange:e.meta.textRange,viewportRect:d,isScrolledIntoView:V.UL.doesRectContain(r,d)}}))))))}(r,i.client,t,e))))))).subscribe(s.wW(this._selectionHighlight)))}dispose(){this._subs.unsubscribe()}}class Ye{constructor(e){this._params=e,this._subs=new a.w,this._logger=h.Y.create("G2FeatureImpl"),this._alertFilter=l.h.create(d.W8),this._integration=(0,z.a9)(this._params.integrationName)?new Y({textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement,textObserver:this._params.textObserver,selectionSource:this._params.selectionSource,selectionService:this._params.selectionService}):new q({integrationName:this._params.integrationName,textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement,selectionService:this._params.selectionService,telemetry:this._params.telemetry}),this._rewriteService=new _e({checkingService:this._params.checkingService,telemetry:this._params.telemetry}),this._paragraphCollectionService=new Fe({textObserver:this._params.textObserver}),this._paragraphHighlightCollectionGeometry=new Ne.C(this._params.geometryProvider,this._params.geometryLayout,(()=>this._params.textObserver.getCurrentTextMap()),this._integration.highlightGeometryFilter,(0,P.WF)(this._params.textFieldLayout),(0,Ue.m)()),this._paragraphHighlightCollectionViewModel=new Be({paragraphCollectionService:this._paragraphCollectionService,paragraphHighlightCollectionGeometry:this._paragraphHighlightCollectionGeometry,textFieldLayout:this._params.textFieldLayout,mouseData:this._params.mouseData,textFieldElement:this._params.textFieldElement,integration:this._integration,telemetry:this._params.telemetry}),this._selectionHighlightGeometry=new Ne.C(this._params.geometryProvider,this._params.geometryLayout,(()=>this._params.textObserver.getCurrentTextMap()),this._integration.highlightGeometryFilter,(0,P.WF)(this._params.textFieldLayout),(0,Ue.m)()),this._selectionHighlightViewModel=new Oe({selectionHighlightGeometry:this._selectionHighlightGeometry,textFieldLayout:this._params.textFieldLayout,textObserver:this._params.textObserver,integration:this._integration}),this._sidelineCollectionViewModel=new L({paragraphCollectionService:this._paragraphCollectionService,paragraphHighlightCollectionViewModel:this._paragraphHighlightCollectionViewModel,alerts:this._params.alertProcessor.alerts.state.view((e=>Object.values(e).filter(I.Nf).filter(o.S.isTransformJsonCapiAlert))),textObserver:this._params.textObserver,textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement,selectionHighlightViewModel:this._selectionHighlightViewModel,legacyAssistantOpenState:this._params.legacyAssistantOpenState,assistantState:this._params.assistantState,telemetry:this._params.telemetry}),this._replacementService=this._params.replacementServiceInjector.create(Ie.P.g2),this._sidelineCardViewModel=new xe({rewriteService:this._rewriteService,sidelineCollectionViewModel:this._sidelineCollectionViewModel,performReplacement:e=>this._replacementService.performReplacement(e),telemetry:this._params.telemetry}),this.alertFilter=this._alertFilter.view(),this._logger.debug("G2 initialized.",{integrationName:this._params.integrationName});const i=(t=this._params.integrationName,(0,z.a9)(t)||"test2_aggressive"===(0,Q.OB)().experimentClient.getTreatment(X.p.G2NonGDocs)?Z:ee);var t;this._subs.add(this._params.alertClassification.visibleInlineAlertsFilter.pipe(n.U((e=>t=>e(t)&&i(t)))).subscribe(s.wW(this._alertFilter)))}get paragraphHighlightsUI(){return r.createElement(r.Suspense,{fallback:r.createElement(r.Fragment,null)},r.createElement(c,{paragraphHighlights:this._paragraphHighlightCollectionViewModel.paragraphHighlights}))}get sidelinesUI(){return r.createElement(r.Suspense,{fallback:r.createElement(r.Fragment,null)},r.createElement(g,{paragraphSidelines:this._sidelineCollectionViewModel.paragraphSidelines,emphasizedSideline:this._sidelineCollectionViewModel.emphasizedSideline,activeSideline:this._sidelineCollectionViewModel.activeSideline,pinnedSideline:this._sidelineCollectionViewModel.pinnedSideline,shouldHideSidelines:this._sidelineCollectionViewModel.shouldHideSidelines,selectionSideline:this._sidelineCollectionViewModel.selectionSideline,onActivateSideline:e=>this._sidelineCollectionViewModel.activateSideline(e),onDeactivateSideline:e=>this._sidelineCollectionViewModel.deactivateSideline(e),onPinSideline:e=>this._sidelineCollectionViewModel.pinSideline(e),onUnpinSideline:e=>this._sidelineCollectionViewModel.unpinSideline(e),onMountSideline:(e,i)=>this._sidelineCollectionViewModel.setSidelineReferenceElement(e,i),telemetry:this._params.telemetry}))}get sidelineCardUI(){return r.createElement(r.Suspense,{fallback:r.createElement(r.Fragment,null)},r.createElement(ve,{visibleSidelineCard:this._sidelineCardViewModel.visibleSidelineCard,visibleSidelineCardRewriteInfo:this._sidelineCardViewModel.visibleSidelineCardRewriteInfo,onActivateSidelineCard:e=>this._sidelineCardViewModel.activateSidelineCard(e),onDeactivateSidelineCard:e=>this._sidelineCardViewModel.deactivateSidelineCard(e),onChangeSelectedRewriteType:e=>this._sidelineCardViewModel.notifySelectedRewriteTypeChanged(e),onApplyRewrite:(e,i)=>this._sidelineCardViewModel.applyRewrite(e,i),onCopyRewrite:e=>this._sidelineCardViewModel.copyRewrite(e),telemetry:this._params.telemetry}))}dispose(){this._subs.unsubscribe(),this._integration.dispose(),this._rewriteService.dispose(),this._paragraphCollectionService.dispose(),this._paragraphHighlightCollectionGeometry.dispose(),this._paragraphHighlightCollectionViewModel.dispose(),this._selectionHighlightGeometry.dispose(),this._selectionHighlightViewModel.dispose(),this._sidelineCollectionViewModel.dispose(),this._sidelineCardViewModel.dispose()}}},1284:(e,i,t)=>{t.r(i),t.d(i,{ParagraphHighlightCollection:()=>l});var r=t(43818),a=t(49231),n=t(72143),s=t(75851);const l=({paragraphHighlights:e})=>a.createElement(r.F.Fragment,null,e.view((e=>a.createElement(n.L,{key:"g2",chunkName:"g2"},e.map((e=>a.createElement("div",{"data-testid":"grammarly-g2-paragraph-highlight",className:s.paragraphHighlight,key:e.id,style:{top:e.textFieldRect.top,left:e.textFieldRect.left,width:e.textFieldRect.width,height:e.textFieldRect.height}})))))))},16406:(e,i,t)=>{t.r(i),t.d(i,{SidelineCard:()=>J});var r=t(43818),a=t(49231),n=t(15868),s=t(69910);const l=({referenceElement:e,onMouseEnter:i,onMouseLeave:t,onFocus:r,onBlur:l,children:d})=>{const[o,h]=a.useState(null),{styles:c,attributes:g,state:p}=(0,n.D)(e,o,{placement:"bottom-start"});return a.createElement("div",{"data-testid":"grammarly-g2-sideline-card-popper",role:"dialog","aria-label":"Suggested rewrite dialog",tabIndex:0,ref:h,style:c.popper,className:s.sidelineCardPopper,onMouseEnter:i,onMouseLeave:t,onFocus:r,onBlur:l,...g.popper},d(null==p?void 0:p.placement))};var d=t(66571),o=t(79796);const h=()=>a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeleton,"data-testid":"grammarly-g2-sideline-card-rewrite-loading-skeleton"},a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonSignal}),a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContent},a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContentTitle}),a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContentText},a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContentTextLine}),a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContentTextLine}),a.createElement("div",{className:o.sidelineCardRewriteLoadingSkeletonContentTextLine}))));var c=t(46323),g=t(22223),p=t(41088),m=t(87188),u=t(29368);const w=({title:e,text:i})=>a.createElement("div",{className:c.sidelineCardRewriteSuccess,"data-testid":"grammarly-g2-sideline-card-rewrite-success"},a.createElement("div",{className:c.sidelineCardRewriteSuccessMain,"data-testid":"grammarly-g2-sideline-card-rewrite-success-main"},a.createElement(g.J,{size:"small",accessibilityLabel:"",icon:p.j}),a.createElement("div",{className:c.sidelineCardRewriteSuccessMainContent,"data-testid":"grammarly-g2-sideline-card-rewrite-success-main-content"},a.createElement(m.x,{className:c.sidelineCardRewriteSuccessMainContentTitle,as:"strong",color:"brand-default",variant:"text-small"},e),a.createElement(m.x,{as:"p",variant:"text-small",color:"base-subdued"},i))),a.createElement("div",{className:c.sidelineCardRewriteSuccessFooter,"data-testid":"grammarly-g2-sideline-card-rewrite-success-footer"},a.createElement(g.J,{size:"small",icon:u.p,accessibilityLabel:"Grammarly logo"})));var _=t(69587),v=t(99627),f=t(97357),S=t(41246),b=t(72721),y=t(29564),C=t(43831);const R=e=>{const[i,t]=a.useState(!1),r=a.useRef(void 0),n=a.useCallback((()=>{void 0!==r.current&&(self.clearTimeout(r.current),r.current=void 0)}),[]);a.useEffect(n,[]);return a.createElement(S.k,{className:C.sidelineCardRewriteCopyButton},i&&a.createElement(S.k,{className:C.sidelineCardRewriteCopyButtonCopyConfirmation,bgColor:"background-base-default"},a.createElement(m.x,{as:"p",variant:"text-xsmall",color:"base-subdued"},"Copied")),a.createElement(b.h,{variant:"tertiary",accessibilityLabel:"Copy",icon:y.c,size:"small",onClick:async()=>{await e.onClick(),t(!0),n(),r.current=self.setTimeout((()=>{t(!1)}),3e3)}}))};var x=t(59833),I=t(83138),E=t(90023),F=t(51201);const k={color:F.I.Text.Brand.Default,background:"rgba(177, 240, 232, 0.6)",fontWeight:"bold"},T={color:"#696969",backgroundColor:"rgba(156, 156, 156, 0.2)",textDecoration:"line-through"},G={color:F.I.Text.Base.Default,backgroundColor:F.I.Background.Base.Default},M=({diff:e})=>a.createElement("p",null,(0,E.zG)(e,x.Su(((e,i)=>(0,E.zG)(i,I.F.matchOperation({onDelete:i=>a.createElement(m.x,{as:"span",variant:"text-small",key:e,style:T},i),onInsert:i=>a.createElement(m.x,{as:"span",variant:"text-small",key:e,style:k},i),onRetain:i=>a.createElement(m.x,{as:"span",variant:"text-small",key:e,style:G},i)}))))));var L=t(58303);function P(e){return"attention"===e?_.sidelineCardRewriteReadyContentTitleAttention:"writingCoach"===e?_.sidelineCardRewriteReadyContentTitleWritingCoach:_.sidelineCardRewriteReadyContentTitleDefault}const z=e=>{const[i,t]=a.useState(null);a.useEffect((()=>{e.telemetry.infoOncePerMessage({message:"Rendering sideline card succeeded."})}),[]);return a.createElement("div",{className:_.sidelineCardRewriteReady,"data-testid":"grammarly-g2-sideline-card-rewrite-ready"},a.createElement("div",{...(0,v.Sh)(_.sidelineCardRewriteReadySignalBar,(n=e.signal,"attention"===n?_.sidelineCardRewriteReadySignalBarAttention:"writingCoach"===n?_.sidelineCardRewriteReadySignalBarWritingCoach:_.sidelineCardRewriteReadySignalBarDefault)),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-signal"}),a.createElement("div",{className:_.sidelineCardRewriteReadyContainer,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-container"},a.createElement("div",{className:(r=null==i?void 0:i.getBoundingClientRect().height,r&&r>=190?_.sidelineCardRewriteReadyContentScrollable:_.sidelineCardRewriteReadyContent),"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content",ref:t},a.createElement(m.x,{...(0,v.Sh)(_.sidelineCardRewriteReadyContentTitle,P(e.signal)),as:"strong",variant:"text-small"},e.title),(0,E.zG)(e.diff,L.UI((e=>a.createElement(M,{key:"diff",diff:e}))),L.fS((()=>a.createElement(m.x,{as:"p",variant:"text-small"},e.newText))))),a.createElement("div",{className:_.sidelineCardRewriteReadyContentToolbar,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar"},a.createElement("div",{className:_.sidelineCardRewriteReadyContentToolbarLeft,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-left"},a.createElement(f.z,{variant:"tertiary",text:"apply"===e.applyCTA?"Accept":"Insert",shortcut:"⮐",size:"small",onClick:e.onApply,"data-testid":"apply"===e.applyCTA?"grammarly-g2-sideline-card-rewrite-ready-content-apply-btn":"grammarly-g2-sideline-card-rewrite-ready-content-insert-btn",className:_.sidelineCardRewriteReadyContentToolbarLeftActionBtn})),a.createElement("div",{className:_.sidelineCardRewriteReadyContentToolbarRight,"data-testid":"grammarly-g2-sideline-card-rewrite-ready-content-toolbar-right"},a.createElement(R,{onClick:e.onCopy}),a.createElement(g.J,{icon:u.p,accessibilityLabel:"Grammarly logo"})))));var r,n};var A=t(27954),H=t(3190);function V(e){return e?["Assistance unavailable",e]:["Couldn’t generate ideas","Please wait a moment, then try again."]}const B=({errorDetails:e})=>a.createElement(S.k,{direction:"column",align:"center",gap:.5,padding:8,"data-testid":"grammarly-g2-sideline-card-rewrite-error"},a.createElement(g.J,{icon:A.F,size:"large",variant:"warning",accessibilityLabel:"","data-testid":"grammarly-g2-sideline-card-rewrite-error-icon"}),a.createElement(m.x,{as:"p",variant:"text-medium",color:"base-default",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-title"},(0,H.li)(V(e))),a.createElement(m.x,{as:"p",variant:"text-small",color:"base-subdued",align:"center","data-testid":"grammarly-g2-sideline-card-rewrite-error-subtitle"},(0,H.Yg)(V(e)))),N=e=>a.createElement("div",{role:"region","aria-live":"error"===e.kind?"assertive":"polite","aria-busy":"loading"===e.kind,"aria-label":U(e.kind),"data-testid":"grammarly-g2-sideline-card-rewrite"},(()=>{switch(e.kind){case"loading":return a.createElement(h,null);case"ready":return a.createElement(z,{signal:e.signal,title:e.title,newText:e.newText,diff:e.diff,applyCTA:e.applyCTA,onApply:e.onApply,onCopy:e.onCopy,telemetry:e.telemetry});case"success":return a.createElement(w,{title:e.title,text:e.text});case"error":return a.createElement(B,{errorDetails:e.errorDetails});default:(0,d.L0)(e)}})());function U(e){switch(e){case"loading":return"Loading suggested rewrite";case"ready":case"success":return"Suggested rewrite";case"error":return"An error occurred";default:(0,d.L0)(e)}}var D=t(6584),O=t(83536);const Y=({shortenRewriteInfo:e,friendlyRewriteInfo:i,formalRewriteInfo:t})=>a.createElement(O.m.TabList,{accessibilityLabel:"Type of rewrite",bottomBorder:"none"},a.createElement(O.m.Tab,{id:"improve",label:"Improve"}),a.createElement(O.m.Tab,{id:"rephrase",label:"Rephrase"}),e&&a.createElement(O.m.Tab,{id:"shorten",label:"Shorten"}),i&&a.createElement(O.m.Tab,{id:"friendly",label:"Friendly"}),t&&a.createElement(O.m.Tab,{id:"formal",label:"Formal"})),W=({improveRewriteInfo:e,rephraseRewriteInfo:i,shortenRewriteInfo:t,friendlyRewriteInfo:r,formalRewriteInfo:n})=>a.createElement(a.Fragment,null,a.createElement(O.m.Panel,{id:"improve"},a.createElement(N,{...e})),a.createElement(O.m.Panel,{id:"rephrase"},a.createElement(N,{...i})),t&&a.createElement(O.m.Panel,{id:"shorten"},a.createElement(N,{...t})),r&&a.createElement(O.m.Panel,{id:"friendly"},a.createElement(N,{...r})),n&&a.createElement(O.m.Panel,{id:"formal"},a.createElement(N,{...n}))),j=({tabListPosition:e,improveRewriteInfo:i,rephraseRewriteInfo:t,shortenRewriteInfo:r,friendlyRewriteInfo:n,formalRewriteInfo:s,onChangeSelectedRewriteType:l})=>{const d=a.createElement(Y,{shortenRewriteInfo:r,friendlyRewriteInfo:n,formalRewriteInfo:s}),o=a.createElement(W,{improveRewriteInfo:i,rephraseRewriteInfo:t,shortenRewriteInfo:r,friendlyRewriteInfo:n,formalRewriteInfo:s});return a.createElement("div",{className:D.sidelineCard,"data-testid":"grammarly-g2-sideline-card"},a.createElement(O.m,{defaultSelectedTab:"improve",onChange:e=>l(e)},"top"===e?d:o,a.createElement("div",{className:D.sidelineCardHorizontalDivider}),"bottom"===e?d:o))};var $=t(72143);const J=({visibleSidelineCard:e,visibleSidelineCardRewriteInfo:i,onActivateSidelineCard:t,onDeactivateSidelineCard:n,onChangeSelectedRewriteType:s,onApplyRewrite:o,onCopyRewrite:h,telemetry:c})=>{const g=(e,i)=>(0,E.zG)(e,L.UI((e=>function(e,i,t,r,a){return"loading"===e.kind||"idle"===e.kind?{kind:"loading"}:"ready"===e.kind?e.text===e.rewriteText?{kind:"success",title:"This text looks great!",text:"To rephrase your text, select another option."}:{kind:"ready",title:e.title,newText:e.rewriteText,diff:e.rewriteDiff,applyCTA:"improve"===e.type?"apply":"insert",onApply:()=>t(e),onCopy:()=>r(e),signal:(0,E.zG)(i,L.hX((()=>"improve"===e.type)),L.hX((e=>"attention"===e||"writingCoach"===e)),L.FS),telemetry:a}:"error"===e.kind?{kind:"error",errorDetails:e.errorDetails}:void(0,d.L0)(e)}(e,i.sidelineSignal,(e=>o(e,i)),h,c))));return a.createElement(r.F.Fragment,null,e.view((0,E.ls)(L.UI((e=>a.createElement($.L,{key:"g2",chunkName:"g2"},a.createElement(l,{referenceElement:e.referenceElement,onMouseEnter:()=>t(e),onMouseLeave:()=>{e.isSidelinePinned||n(e)},onFocus:()=>t(e),onBlur:()=>n(e)},(t=>a.createElement(r.F.Fragment,null,i.view((({improve:i,rephrase:r,shorten:n,friendly:l,formal:d})=>a.createElement(j,{tabListPosition:"bottom"===t||"bottom-end"===t||"bottom-start"===t?"top":"bottom",improveRewriteInfo:(0,E.zG)(g(i,e),L.pF((()=>({kind:"loading"})))),rephraseRewriteInfo:(0,E.zG)(g(r,e),L.pF((()=>({kind:"loading"})))),shortenRewriteInfo:(0,E.zG)(g(n,e),L.pF((()=>{}))),friendlyRewriteInfo:(0,E.zG)(g(l,e),L.pF((()=>{}))),formalRewriteInfo:(0,E.zG)(g(d,e),L.pF((()=>{}))),onChangeSelectedRewriteType:e=>s(e)}))))))))),L.WG)))}},64738:(e,i,t)=>{t.r(i),t.d(i,{SidelineCollection:()=>v});var r=t(58303),a=t(99627),n=t(43818),s=t(25770),l=t(90023),d=t(49231),o=t(72143),h=t(8780),c=t(22223),g=t(29978),p=t(66571);const m=d.forwardRef((function({emphasized:e,signal:i,heightInPixels:t,onClick:r,onMouseOver:n,onMouseOut:s,onFocus:l,onBlur:o,telemetry:m},u){d.useEffect((()=>{m.infoOncePerMessage({message:"Rendering sideline succeeded."})}),[]);const w=("attention"===i||"loading"===i||"writingCoach"===i)&&!(e&&!(t>=24));return d.createElement("button",{"data-testid":"grammarly-g2-sideline",...(0,a.Sh)(h.sideline,e?h.sidelineEmphasized:h.sidelineIdle,"selection"===i?h.sidelineWithSelectionSignal:void 0,w?h.sidelineWithSignalBar:void 0),style:{height:t,width:16},disabled:!e,onClick:e?r:void 0,onFocus:e?l:void 0,onBlur:e?o:void 0,onMouseOver:n,onMouseOut:s,"aria-label":"See rewrite suggestions",ref:u},d.createElement("div",{...(0,a.Sh)(h.sidelineSignalBar,(e=>{switch(e){case"loading":return h.sidelineSignalBarLoading;case"attention":return h.sidelineSignalBarAttention;case"writingCoach":return h.sidelineSignalBarWritingCoach;case"selection":case void 0:return;default:(0,p.L0)(e)}})(i),e?h.sidelineSignalBarEmphasized:void 0,w?void 0:h.sidelineSignalBarHidden),role:"status","aria-label":"Rewrite suggestions available"}),d.createElement(c.J,{...(0,a.Sh)(h.sidelineArrow,e?h.sidelineArrowVisible:void 0,w?h.sidelineArrowBottom:void 0),icon:g.b,accessibilityLabel:"",size:"small",variant:"selection"===i?"inverse":"default"}))}));var u=t(93496);function w(e,i,t){return(0,l.zG)(i,r.UI((i=>i===e)),r.wp((()=>(0,l.zG)(t,r.UI((i=>i===e))))),r.fS((()=>!1)))}const _=({sidelineId:e,isEmphasized:i,isActive:t,viewportRect:r,signal:n,onMount:s,onPin:l,onUnpin:o,onActivate:h,onDeactivate:c,telemetry:g})=>d.createElement(d.Fragment,null,d.createElement("span",{"data-testid":`grammarly-g2-sideline-paragraph-highlighter-${e}`,...(0,a.Sh)(u.sidelineParagraphHighlighter,t?u.sidelineParagraphHighlighterActive:void 0),style:{top:r.top-4,left:r.left-8-4,width:r.width+8+8,height:r.height+8},ref:i=>{i&&s(e,i)}}),d.createElement("span",{"data-testid":`grammarly-g2-sideline-positioner-${e}`,className:u.sidelinePositioner,style:{top:r.top,left:r.left-8}},d.createElement(m,{emphasized:i,signal:n,heightInPixels:r.height,onClick:()=>l(e),onFocus:()=>l(e),onBlur:()=>o(e),onMouseOver:()=>h(e),onMouseOut:()=>c(e),telemetry:g}))),v=({paragraphSidelines:e,emphasizedSideline:i,activeSideline:t,pinnedSideline:a,selectionSideline:h,shouldHideSidelines:c,onActivateSideline:g,onDeactivateSideline:p,onPinSideline:m,onUnpinSideline:u,onMountSideline:v,telemetry:f})=>d.createElement(n.F.Fragment,null,s.h.combine(e,i,t,a,h,c,((e,i,t,a,n,s)=>d.createElement(o.L,{key:"g2",chunkName:"g2"},s?null:(0,l.zG)(n,r.UI((e=>d.createElement(_,{sidelineId:e.id,isEmphasized:!0,isActive:w(e.id,(0,l.zG)(a,r.UI((e=>e.id))),(0,l.zG)(t,r.UI((e=>e.id)))),viewportRect:e.selectionHighlightViewportRect,signal:"selection",onMount:(e,i)=>v(e,i),onPin:e=>m(e),onUnpin:e=>u(e),onActivate:e=>g(e),onDeactivate:e=>p(e),telemetry:f}))),r.fS((()=>d.createElement(d.Fragment,null,e.map((e=>{return d.createElement(d.Fragment,{key:e.id},d.createElement(_,{sidelineId:e.id,isEmphasized:(n=e.id,s=(0,l.zG)(a,r.UI((e=>e.id))),o=(0,l.zG)(t,r.UI((e=>e.id))),h=(0,l.zG)(i,r.UI((e=>e.id))),(0,l.zG)(s,r.UI((e=>e===n)),r.fS((()=>(0,l.zG)(o,r.UI((e=>e===n)),r.fS((()=>!1)))||(0,l.zG)(h,r.UI((e=>e===n)),r.fS((()=>!1))))))),isActive:w(e.id,(0,l.zG)(a,r.UI((e=>e.id))),(0,l.zG)(t,r.UI((e=>e.id)))),viewportRect:e.paragraphHighlightViewportRect,signal:r.FS(e.signal),onMount:(e,i)=>v(e,i),onPin:e=>m(e),onUnpin:e=>u(e),onActivate:e=>g(e),onDeactivate:e=>p(e),telemetry:f}));var n,s,o,h}))))))))))},83138:(e,i,t)=>{t.d(i,{F:()=>r});var r,a=t(60213),n=t(3190),s=t(12518),l=t(53186),d=t(90023),o=t(95907);!function(e){let i;e.getDiff=(e,i)=>(0,d.zG)(s.tryCatch((()=>{const t=new a.diff_match_patch,r=t.diff_main(e,i);return t.diff_cleanupSemantic(r),r}),s.toError),s.chain((0,d.ls)(l.nI,s.fromOption((()=>new Error("Diff is empty")))))),function(e){e[e.DELETE=-1]="DELETE",e[e.RETAIN=0]="RETAIN",e[e.INSERT=1]="INSERT"}(i=e.Operation||(e.Operation={})),e.matchOperation=function({onInsert:e,onDelete:t,onRetain:r}){return a=>{const s=(0,n.li)(a);switch(s){case i.INSERT:return e((0,n.Yg)(a));case i.DELETE:return t((0,n.Yg)(a));case i.RETAIN:return r((0,n.Yg)(a));default:(0,o.vE)(s)}}}}(r||(r={}))},84548:(e,i,t)=>{t.d(i,{$x:()=>s,F8:()=>m,Go:()=>a,Kt:()=>b,Lq:()=>o,Q2:()=>f,QR:()=>E,Qy:()=>_,Vk:()=>y,Wp:()=>r,XG:()=>n,_m:()=>g,d0:()=>h,f:()=>d,gH:()=>w,gL:()=>C,gv:()=>u,ij:()=>I,j5:()=>S,jW:()=>p,lO:()=>x,os:()=>v,rx:()=>R,uj:()=>c,y1:()=>l});const r=".kix-appview-editor",a=".docos-input",n=".docs-texteventtarget-iframe",s=".kix-cursor",l=".kix-cursor-caret",d="#docs-revisions-sidebar",o='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',h="#docs-toolbar-mode-switcher",c="edit-mode",g="suggest-mode",p="#titlebar-mode-indicator-container .titlebar-request-access-button",m="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",u=".kix-canvas-tile-content",w="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",_=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",v=".kix-page-paginated.canvas-first-page",f="kix-page-canvas-compact-mode",S=".docs-horizontal-ruler",b=".docs-vertical-ruler",y="#fontSizeSelect input",C=".docs-ruler-background",R=".docs-ruler-background-inner",x=".docs-ruler-indent-first-line",I=".modal-dialog.docs-dialog .fatal-error-message",E='#docs-titlebar-share-client-button div[role="button"]'},12201:(e,i,t)=>{t.d(i,{b:()=>l});var r=t(82823),a=t(140),n=t(57724),s=t(25770);class l{constructor(e){this._textObserver=e,this._mapChangedAtom=s.h.create([0,[]]),this._sub=new r.w,this.highlightsFilterFactory=()=>s.h.combine((0,a.u)(),this._mapChangedAtom,((e,i)=>{const t=this._textObserver.getCurrentTextMap();return{filter:i=>e.filter(i)&&(null!==t.getFragmentAtOffset(i.start)||null!==t.getFragmentAtOffset(i.end)||null!==t.getFragmentAtOffset(i.end-1)),type:n.qH.ChangeType.preserve}})),this._sub.add(this._textObserver.textMapChanged.subscribe((e=>{this._mapChangedAtom.modify((([i,t])=>[i+1,e]))})))}dispose(){this._sub.unsubscribe()}}},61442:(e,i,t)=>{t.d(i,{Sz:()=>n,vQ:()=>a});var r=t(12518);async function a(e,i=self){if(function(e=self){var i,t;return!!(null===(t=null===(i=e.navigator)||void 0===i?void 0:i.clipboard)||void 0===t?void 0:t.writeText)}(i))return i.navigator.clipboard.writeText(e);throw new Error("Clipboard API not supported")}function n(e,i=self){return a(e,i).then((()=>r.right(void 0))).catch((e=>r.left(e instanceof Error?e:new Error(String(e)))))}},61031:(e,i,t)=>{function r(e,i=0){return(i<<5)-i+(0|e)|0}function a(e,i=0){let t=i;for(const i of e)t=r(i.charCodeAt(0),t);return t}t.d(i,{Wu:()=>a,k3:()=>r})},8780:e=>{e.exports={sideline:"G2vdT",sidelineEmphasized:"tw3gA",sidelineWithSelectionSignal:"ikZS7",sidelineWithSignalBar:"gtUhG",sidelineSignalBar:"Pdlcn",sidelineSignalBarLoading:"ZhtAx",pulse:"PEPt4",sidelineSignalBarAttention:"xQocX",sidelineSignalBarWritingCoach:"O4JQp",sidelineSignalBarEmphasized:"_mi1U",sidelineSignalBarHidden:"BNKg6",sidelineArrow:"Ihuz1",sidelineArrowVisible:"gtlTF",sidelineArrowBottom:"PPzfY"}},6584:e=>{e.exports={sidelineCard:"KetZV",sidelineCardHorizontalDivider:"d96oB"}},69910:e=>{e.exports={sidelineCardPopper:"m2vlI"}},43831:e=>{e.exports={sidelineCardRewriteCopyButton:"_kIwY","5rem":"TE61X",sidelineCardRewriteCopyButtonCopyConfirmation:"eH5TV"}},79796:e=>{e.exports={sidelineCardRewriteLoadingSkeleton:"AZpqD",sidelineCardRewriteLoadingSkeletonSignal:"QmlkU",blink:"ME70b",sidelineCardRewriteLoadingSkeletonContent:"pCdaZ",sidelineCardRewriteLoadingSkeletonContentTitle:"njaNp",sidelineCardRewriteLoadingSkeletonContentText:"tFJmW",sidelineCardRewriteLoadingSkeletonContentTextLine:"CUydw"}},69587:e=>{e.exports={sidelineCardRewriteReady:"aC0Qq",sidelineCardRewriteReadySignalBar:"zv_Ws",sidelineCardRewriteReadySignalBarAttention:"oimfv",sidelineCardRewriteReadySignalBarWritingCoach:"OgCkm",sidelineCardRewriteReadySignalBarDefault:"GGpaV",sidelineCardRewriteReadyContainer:"JCAN0",sidelineCardRewriteReadyContentScrollable:"Cq6T4",sidelineCardRewriteReadyContent:"ANoVu",sidelineCardRewriteReadyContentTitle:"JruGr",sidelineCardRewriteReadyContentTitleAttention:"ncGgB",sidelineCardRewriteReadyContentTitleWritingCoach:"TNHGD",sidelineCardRewriteReadyContentTitleDefault:"FKJEV",sidelineCardRewriteReadyContentToolbar:"AkoCa",sidelineCardRewriteReadyContentToolbarLeft:"Fl51m",sidelineCardRewriteReadyContentToolbarLeftActionBtn:"s_g6E",sidelineCardRewriteReadyContentToolbarRight:"UPwBp"}},46323:e=>{e.exports={sidelineCardRewriteSuccess:"qCfRi",sidelineCardRewriteSuccessMain:"EHpcl",sidelineCardRewriteSuccessMainContent:"YnX7U",sidelineCardRewriteSuccessMainContentTitle:"KYYEg",sidelineCardRewriteSuccessFooter:"mKGH0"}},75851:e=>{e.exports={paragraphHighlight:"GdUyo"}},93496:e=>{e.exports={sidelineParagraphHighlighter:"ch8Da",sidelineParagraphHighlighterActive:"x3IoY",sidelinePositioner:"lx6ct"}}}]);